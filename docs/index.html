<!DOCTYPE html>
<!-- Version: rating-system-local v1.0 (no-backend, GitHub Pages), Build: 20250924-040054 -->
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>評分系統（無後端版）</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Inter', sans-serif; background:#f0f4f8; color:#2d3748; }
    .container { max-width:1200px; margin:auto; padding:1.5rem;}
    .card { background:#fff; border-radius:1rem; box-shadow:0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05); padding:2rem;}
    .button-primary{ background:#4c51bf; color:#fff; padding:.75rem 1.5rem; border-radius:.5rem; font-weight:600; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center;}
    .button-primary:hover{ background:#3b4097; transform: translateY(-2px);}
    .button-secondary{ background:#e2e8f0; color:#4a5568; padding:.75rem 1.5rem; border-radius:.5rem; font-weight:600; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center;}
    .button-secondary:hover{ background:#cbd5e0; transform: translateY(-2px);}
    .input-field{ width:100%; padding:.75rem; border-radius:.5rem; border:1px solid #d1d5db; background:#f9fafb;}
    .leaderboard-table th, .leaderboard-table td{ padding:.75rem; border-bottom:1px solid #e2e8f0; text-align:left;}
    .score-bar-container{ position:relative; width:100%; height:10px; background:#e2e8f0; border-radius:5px; cursor:pointer;}
    .score-bar{ height:100%; background:#4c51bf; border-radius:5px; transition: width .2s;}
    .improve{ color:#dc2626;} .average{ color:#d97706;} .good{ color:#3b82f6;} .excellent{ color:#16a34a;}
    .score-bar.improve{ background:#dc2626;} .score-bar.average{ background:#d97706;} .score-bar.good{ background:#3b82f6;} .score-bar.excellent{ background:#16a34a;}
    .hidden{ display:none;}
  </style>
</head>
<body>
  <div class="container">
    <header class="text-center my-8">
      <h1 class="text-4xl font-bold text-gray-900" data-zh="評分系統" data-ko="평가 시스템"></h1>
      <p id="userIdDisplay" class="text-sm text-gray-500 mt-2" data-zh="離線模式（儲存於瀏覽器）" data-ko="오프라인 모드 (브라우저 저장)"></p>
      <div class="mt-4 flex flex-row justify-center gap-2 flex-wrap">
        <button id="langZh" class="button-secondary text-sm px-4 py-2">中文</button>
        <button id="langKo" class="button-secondary text-sm px-4 py-2">한국어</button>
        <button id="importJsonBtn" class="button-secondary text-sm px-4 py-2"><i class="fa-solid fa-file-import mr-2"></i><span data-zh="匯入JSON" data-ko="JSON 가져오기"></span></button>
        <button id="exportJsonBtn" class="button-secondary text-sm px-4 py-2"><i class="fa-solid fa-file-export mr-2"></i><span data-zh="導出JSON" data-ko="JSON 내보내기"></span></button>
        <button id="exportCsvBtn" class="button-secondary text-sm px-4 py-2"><i class="fa-solid fa-table mr-2"></i><span data-zh="導出CSV" data-ko="CSV 내보내기"></span></button>
        <button id="resetBtn" class="button-secondary text-sm px-4 py-2"><i class="fa-solid fa-trash mr-2"></i><span data-zh="清空資料" data-ko="데이터 초기화"></span></button>
        <input id="fileInput" type="file" accept=".json" class="hidden" />
      </div>
    </header>

    <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Scoring Form -->
      <section class="card">
        <h2 class="text-2xl font-semibold mb-6 text-gray-800" data-zh="評分表單" data-ko="평가 양식"></h2>
        <form id="scoringForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-user-secret mr-2 text-purple-600"></i><span data-zh="評審" data-ko="심사위원"></span></label>
            <select id="judge" name="judge" class="input-field"></select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-user-tie mr-2 text-blue-600"></i><span data-zh="分享者" data-ko="발표자"></span></label>
            <select id="presenter" name="presenter" class="input-field"></select>
          </div>
          <div id="scoreInputs" class="space-y-6"></div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-comment-dots mr-2 text-green-600"></i><span data-zh="評語" data-ko="코멘트"></span></label>
            <textarea id="comment" name="comment" rows="4" class="input-field"></textarea>
          </div>
          <div class="mt-6 flex flex-col sm:flex-row gap-4">
            <button type="submit" class="button-primary w-full sm:w-auto">
              <i class="fas fa-paper-plane mr-2"></i><span data-zh="提交分數" data-ko="점수 제출"></span>
            </button>
          </div>
        </form>
      </section>

      <!-- Leaderboard -->
      <section class="card">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-semibold text-gray-800" data-zh="即時排行榜" data-ko="실시간 순위"></h2>
        </div>
        <div id="leaderboard">
          <h3 class="text-xl font-semibold mb-4 text-gray-700" data-zh="綜合排行榜 (加權總分)" data-ko="종합 순위 (가중치 총점)"></h3>
          <div class="overflow-x-auto mb-8">
            <table class="leaderboard-table w-full">
              <thead><tr class="bg-gray-100">
                <th data-zh="排名" data-ko="순위"></th>
                <th data-zh="分享者" data-ko="발표자"></th>
                <th data-zh="平均加權總分" data-ko="평균 가중치 총점"></th>
                <th data-zh="平均總分" data-ko="평균 총점"></th>
              </tr></thead>
              <tbody id="overallLeaderboardBody"></tbody>
            </table>
            <p class="text-sm text-gray-500 mt-2" data-zh="只顯示前五名，完整名單請導出檔案查看。" data-ko="상위 5명만 표시됩니다. 전체 목록은 파일로 내보내세요."></p>
          </div>
        </div>
      </section>
    </main>

    <section id="individualLeaderboardsSection" class="container mt-8">
      <div class="card">
        <h3 class="text-xl font-semibold mb-2 text-gray-700" data-zh="分項排名 (單項分數)" data-ko="항목별 순위 (단일 점수)"></h3>
        <p class="text-sm text-gray-500 mt-2 mb-4" data-zh="只顯示前三名，完整名單請導出檔案查看。" data-ko="상위 3명만 표시됩니다. 전체 목록은 파일로 내보내세요."></p>
        <div id="individualLeaderboards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6"></div>
      </div>
    </section>
  </div>

  <script>
    // i18n
    const translations = {
      zh:{ title:'評分系統', userId:'離線模式（儲存於瀏覽器）', statusImprove:'須改進', statusAverage:'普通', statusGood:'良好', statusExcellent:'優秀' },
      ko:{ title:'평가 시스템', userId:'오프라인 모드 (브라우저 저장)', statusImprove:'개선 필요', statusAverage:'보통', statusGood:'우수', statusExcellent:'탁월' }
    };
    let currentLang='zh';
    function translatePage(lang){
      currentLang=lang;
      document.querySelectorAll('[data-zh]').forEach(el=>{
        el.textContent = (lang==='zh') ? el.getAttribute('data-zh') : el.getAttribute('data-ko');
      });
      document.querySelector('h1').textContent = translations[lang].title;
    }
    document.getElementById('langZh').addEventListener('click', ()=>translatePage('zh'));
    document.getElementById('langKo').addEventListener('click', ()=>translatePage('ko'));

    // data
    const STORAGE_KEY='rating_scores_v1';
    const judges=["Jack","Terus","Elsa","JS KIM","David","Mandy","Gini","Alisa"];
    const presenters=["Olivia","Lily","Joe","DJ","Angel","Christine","Uming","Woody","YC","Webber","Chloe","Ann","Sheryl"];
    const scoreCriteria=[
      { name:"工作內容介紹完整度", key:"work_content_score", weight:0.30, icon:"fas fa-file-alt", color:"#6366f1" },
      { name:"AI 應用成效", key:"ai_effectiveness_score", weight:0.20, icon:"fas fa-robot", color:"#f97316" },
      { name:"對公司貢獻度", key:"company_contribution_score", weight:0.25, icon:"fas fa-handshake", color:"#10b981" },
      { name:"短期計畫與自我發展", key:"future_development_score", weight:0.15, icon:"fas fa-chart-line", color:"#ef4444" },
      { name:"ChatGPT 我的GPTs 運用", key:"gpt_usage_score", weight:0.10, icon:"fas fa-brain", color:"#8b5cf6" }
    ];

    const judgeSelect=document.getElementById('judge');
    const presenterSelect=document.getElementById('presenter');
    const scoreInputsDiv=document.getElementById('scoreInputs');
    const overallLeaderboardBody=document.getElementById('overallLeaderboardBody');
    const individualLeaderboardsDiv=document.getElementById('individualLeaderboards');

    function loadScores(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }catch(e){return [];} }
    function saveScores(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

    function populateDropdowns(){
      judgeSelect.innerHTML='<option value="">請選擇評審</option>';
      judges.forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; judgeSelect.appendChild(o); });
      presenterSelect.innerHTML='<option value="">請選擇分享者</option>';
      presenters.forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; presenterSelect.appendChild(o); });
    }
    function createScoreInputs(){
      scoreInputsDiv.innerHTML='';
      scoreCriteria.forEach(c=>{
        const div=document.createElement('div'); div.className='space-y-1';
        div.innerHTML=`<div class="flex justify-between items-center">
            <label class="block text-sm font-medium text-gray-700">
                <i class="${c.icon} mr-2" style="color:${c.color};"></i>${c.name}
            </label>
            <div class="score-display">
                <span class="score-label" data-score="0">0</span>
                <span class="score-status" data-status=""></span>
            </div>
          </div>
          <div class="score-bar-container" data-key="${c.key}"><div class="score-bar" style="width:0%;"></div></div>
          <input type="hidden" id="${c.key}" name="${c.key}" value="0" required>`;
        scoreInputsDiv.appendChild(div);
        const barC=div.querySelector('.score-bar-container'), bar=div.querySelector('.score-bar'), lbl=div.querySelector('.score-label'), st=div.querySelector('.score-status'), input=div.querySelector('input');
        barC.addEventListener('click', e=>{
          const rect=barC.getBoundingClientRect(), x=e.clientX-rect.left;
          const score=Math.min(10, Math.max(1, Math.round((x/rect.width)*10)));
          input.value=score; bar.style.width=(score*10)+'%'; lbl.textContent=score;
          bar.className='score-bar'; lbl.className='score-label'; st.className='score-status';
          if(score<=3){ bar.classList.add('improve'); lbl.classList.add('improve'); st.classList.add('improve'); st.textContent=translations[currentLang].statusImprove; st.dataset.status='improve';}
          else if(score<=5){ bar.classList.add('average'); lbl.classList.add('average'); st.classList.add('average'); st.textContent=translations[currentLang].statusAverage; st.dataset.status='average';}
          else if(score<=7){ bar.classList.add('good'); lbl.classList.add('good'); st.classList.add('good'); st.textContent=translations[currentLang].statusGood; st.dataset.status='good';}
          else { bar.classList.add('excellent'); lbl.classList.add('excellent'); st.classList.add('excellent'); st.textContent=translations[currentLang].statusExcellent; st.dataset.status='excellent';}
        });
      });
    }

    document.getElementById('scoringForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const judge=judgeSelect.value, presenter=presenterSelect.value, comment=(document.getElementById('comment').value||'');
      const scores=scoreCriteria.map(c=> parseInt(document.getElementById(c.key).value||'0',10));
      if(!judge||!presenter||scores.some(s=>!s)){ alert('請完整填寫。'); return; }
      const total=scores.reduce((a,b)=>a+b,0);
      const weighted=scores.reduce((a,s,i)=>a+s*scoreCriteria[i].weight,0);
      const rec={ judge, presenter, comment, created_at:new Date().toISOString(), total_score:total, weighted_score:weighted };
      scoreCriteria.forEach((c,i)=> rec[c.key]=scores[i]);
      const arr=loadScores(); arr.push(rec); saveScores(arr);
      e.target.reset(); createScoreInputs(); renderLeaderboards();
      alert('分數提交成功（儲存於瀏覽器）。');
    });

    function aggregate(rows){
      const agg={}; presenters.forEach(p=>{ agg[p]={total:0,weighted:0,count:0,items:{}}; scoreCriteria.forEach(c=> agg[p].items[c.key]=0); });
      rows.forEach(r=>{ if(agg[r.presenter]){ agg[r.presenter].total+=+r.total_score||0; agg[r.presenter].weighted+=+r.weighted_score||0; agg[r.presenter].count++; scoreCriteria.forEach(c=> agg[r.presenter].items[c.key]+= +r[c.key]||0); } });
      return Object.keys(agg).map(p=>{
        const d=agg[p], c=d.count||1, obj={ presenter:p, avg_total:(d.total/c).toFixed(2), avg_weighted:(d.weighted/c).toFixed(2)};
        scoreCriteria.forEach(k=> obj[k.key]=(d.items[k.key]/c).toFixed(2)); return obj;
      });
    }
    function renderLeaderboards(){
      const data=aggregate(loadScores());
      // overall
      const overall=[...data].sort((a,b)=> b.avg_weighted - a.avg_weighted);
      overallLeaderboardBody.innerHTML='';
      overall.slice(0,5).forEach((r,i)=>{
        const tr=document.createElement('tr');
        const crown=i===0?'<i class="fas fa-crown text-yellow-500 mr-2"></i>':'';
        tr.innerHTML=`<td class="font-bold text-lg">${i+1}</td><td class="font-medium">${crown}${r.presenter}</td><td>${r.avg_weighted}</td><td>${r.avg_total}</td>`;
        overallLeaderboardBody.appendChild(tr);
      });
      // individuals
      individualLeaderboardsDiv.innerHTML='';
      scoreCriteria.forEach(c=>{
        const sorted=[...data].sort((a,b)=> b[c.key]-a[c.key]);
        const card=document.createElement('div'); card.className='card';
        card.innerHTML=`<h4 class="text-md font-semibold mb-4 text-gray-800"><i class="${c.icon} mr-2" style="color:${c.color};"></i>${c.name}</h4>
          <div class="overflow-x-auto"><table class="leaderboard-table w-full">
          <thead><tr class="bg-gray-100"><th data-zh="排名" data-ko="순위"></th><th data-zh="分享者" data-ko="발표자"></th><th><span data-zh="分數" data-ko="점수"></span></th></tr></thead>
          <tbody></tbody></table></div>`;
        const tb=card.querySelector('tbody');
        sorted.slice(0,3).forEach((r,i)=>{
          const tr=document.createElement('tr'); const crown=i===0?'<i class="fas fa-crown text-yellow-500 mr-2"></i>':'';
          tr.innerHTML=`<td class="font-bold text-lg">${i+1}</td><td class="font-medium">${crown}${r.presenter}</td><td>${r[c.key]}</td>`;
          tb.appendChild(tr);
        });
        individualLeaderboardsDiv.appendChild(card);
      });
      translatePage(currentLang);
    }

    // import/export/reset
    const importBtn=document.getElementById('importJsonBtn'), exportBtn=document.getElementById('exportJsonBtn'), exportCsvBtn=document.getElementById('exportCsvBtn'), fileInput=document.getElementById('fileInput'), resetBtn=document.getElementById('resetBtn');
    exportBtn.addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'),null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ratings.json'; a.click(); });
    importBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', e=>{
      const f=e.target.files[0]; if(!f) return; const r=new FileReader();
      r.onload=()=>{ try{ const arr=JSON.parse(r.result); if(Array.isArray(arr)){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); renderLeaderboards(); alert('匯入完成。'); } else { alert('格式錯誤'); } }catch(err){ alert('解析失敗'); } };
      r.readAsText(f, 'utf-8'); e.target.value='';
    });
    exportCsvBtn.addEventListener('click', ()=>{
      const rows=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
      const headers=["judge","presenter",...scoreCriteria.map(c=>c.key),"total_score","weighted_score","comment","created_at"];
      let csv=headers.join(',')+'\n';
      rows.forEach(r=>{ csv += headers.map(h=>{ let v=r[h]; if(v==null) v=''; if(typeof v==='string') v='"'+v.replace(/"/g,'""')+'"'; return v;}).join(',')+'\n'; });
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='評分報告.csv'; a.click();
    });
    resetBtn.addEventListener('click', ()=>{ if(confirm('確認清空本機資料？')){ localStorage.removeItem(STORAGE_KEY); renderLeaderboards(); alert('已清空。'); } });

    // init
    (function(){ populateDropdowns(); createScoreInputs(); renderLeaderboards(); translatePage('zh'); })();
  </script>
</body>
</html>
